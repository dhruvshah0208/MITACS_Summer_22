(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    107806,       2619]
NotebookOptionsPosition[    104465,       2564]
NotebookOutlinePosition[    104871,       2580]
CellTagsIndexPosition[    104828,       2577]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
Derive the Dynamics using the Lagrangian and the feedforward dynamics.  (A = \
m / (M+m))\
\>", "Text",
 CellChangeTimes->{{3.8612110874080524`*^9, 
  3.861211118925982*^9}},ExpressionUUID->"f7026908-7082-487f-b65f-\
902389ac6090"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g", " ", "=", " ", "1"}], ";", 
  RowBox[{"l", " ", "=", " ", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ldynamics", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", "*", 
      RowBox[{"x2", "^", "2"}]}], " ", "+", " ", 
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", "*", " ", "A", "*", 
      RowBox[{"l", "^", "2"}], "*", 
      RowBox[{"\[Theta]2", "^", "2"}]}], " ", "+", " ", 
     RowBox[{"A", "*", "l", "*", 
      RowBox[{"Cos", "[", "\[Theta]1", "]"}], "*", "x2", "*", "\[Theta]2"}], 
     " ", "+", " ", 
     RowBox[{"A", "*", "g", "*", "l", "*", 
      RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], " ", "-", " ", 
     RowBox[{"u", "*", "x1"}]}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Note", ":", " ", 
    RowBox[{
    "u", " ", "is", " ", "a", " ", "scaled", " ", "version", " ", "of", " ", 
     "the", " ", "original", " ", "control", " ", "by", " ", "a", " ", 
     "factor", " ", "of", " ", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{"M", "+", "m"}], ")"}]}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fdot", "[", "s_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "x1"}], "]"}], "*", "x2"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "x2"}], "]"}], "*", "x2dot"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "\[Theta]1"}], "]"}], "*", "\[Theta]2"}], " ", "+", 
    " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "\[Theta]2"}], "]"}], "*", "\[Theta]2dot"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqn1", " ", "=", " ", 
   RowBox[{
    RowBox[{"fdot", "[", 
     RowBox[{"D", "[", 
      RowBox[{"Ldynamics", ",", "x2"}], "]"}], "]"}], " ", "-", " ", 
    RowBox[{"D", "[", 
     RowBox[{"Ldynamics", ",", "x1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqn2", " ", "=", " ", 
   RowBox[{
    RowBox[{"fdot", "[", 
     RowBox[{"D", "[", 
      RowBox[{"Ldynamics", ",", "\[Theta]2"}], "]"}], "]"}], " ", "-", " ", 
    RowBox[{"D", "[", 
     RowBox[{"Ldynamics", ",", "\[Theta]1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"eqn1", "==", "0"}], ",", 
        RowBox[{"eqn2", " ", "==", " ", "0"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}], "/.", "sol"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fx", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"x2", ",", "x2dot", ",", "\[Theta]2", ",", "\[Theta]2dot"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2", ",", "\[Theta]1", ",", "\[Theta]2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Lambda]", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
     "\[Lambda]1", ",", "\[Lambda]2", ",", "\[Lambda]3", ",", "\[Lambda]4"}], 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{" "}]}], "Input",
 CellChangeTimes->{{3.8611154628301964`*^9, 3.861115477801382*^9}, {
   3.8611155723439775`*^9, 3.861115688877502*^9}, {3.861115719882533*^9, 
   3.8611158785345135`*^9}, {3.861115944338352*^9, 3.861116022872096*^9}, {
   3.8611160782103024`*^9, 3.861116085888831*^9}, {3.861116177781282*^9, 
   3.8611161801665163`*^9}, {3.8611162187850957`*^9, 3.861116418740794*^9}, {
   3.8611164539854603`*^9, 3.8611164578272247`*^9}, {3.8611165571722775`*^9, 
   3.861116753632101*^9}, {3.8611168750360584`*^9, 3.8611168901631947`*^9}, 
   3.8611170357883625`*^9, {3.8611175943777337`*^9, 3.8611175947126245`*^9}, {
   3.8611177945263667`*^9, 3.8611177951591635`*^9}, {3.8611182867450824`*^9, 
   3.8611182888404074`*^9}, {3.8611185415041537`*^9, 
   3.8611186020996685`*^9}, {3.8611187252430706`*^9, 3.861118734350139*^9}, {
   3.8611258367011623`*^9, 3.86112584196947*^9}, {3.8611261494196005`*^9, 
   3.861126152900479*^9}, {3.861126188045179*^9, 3.8611262089424567`*^9}, {
   3.861126313842723*^9, 3.8611263159730396`*^9}, {3.8611277963799677`*^9, 
   3.8611278345806837`*^9}, {3.861130333683022*^9, 3.861130342568165*^9}, {
   3.861130395358189*^9, 3.861130396627781*^9}, {3.8612109540736537`*^9, 
   3.8612109620261126`*^9}, {3.861211001171605*^9, 3.861211079252658*^9}, {
   3.8612111236704655`*^9, 3.861211164709352*^9}, {3.8612112121491957`*^9, 
   3.8612112953706045`*^9}, {3.86121161215639*^9, 3.8612118680416327`*^9}, {
   3.861212137979385*^9, 3.8612121416252203`*^9}, 3.8612125705291805`*^9, {
   3.861212895072485*^9, 3.8612129057630706`*^9}, {3.8612131364783554`*^9, 
   3.8612131687490444`*^9}, {3.861213199283287*^9, 3.861213200426923*^9}, {
   3.861213311722361*^9, 3.8612133631949153`*^9}, {3.861213942837716*^9, 
   3.8612139462516236`*^9}, {3.8612147087459993`*^9, 3.86121470890995*^9}, 
   3.861214947062856*^9, 3.8612162153296337`*^9, {3.8612174883232164`*^9, 
   3.861217494679187*^9}},ExpressionUUID->"855cd7fd-98fc-48d5-9e59-\
76633f5ca378"],

Cell[CellGroupData[{

Cell[BoxData["x2dot"], "Input",
 CellChangeTimes->{{3.861217408300786*^9, 3.8612174093684444`*^9}},
 CellLabel->
  "In[637]:=",ExpressionUUID->"6fb4e5f0-4b6e-4655-a3ea-431f38791ce4"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox[
   RowBox[{
    RowBox[{"-", "u"}], "+", 
    RowBox[{"A", " ", "l", " ", 
     SuperscriptBox["\[Theta]2", "2"], " ", 
     RowBox[{"Sin", "[", "\[Theta]1", "]"}]}], "+", 
    RowBox[{"A", " ", "g", " ", 
     RowBox[{"Cos", "[", "\[Theta]1", "]"}], " ", 
     RowBox[{"Sin", "[", "\[Theta]1", "]"}]}]}], 
   RowBox[{
    RowBox[{"-", "1"}], "+", 
    RowBox[{"A", " ", 
     SuperscriptBox[
      RowBox[{"Cos", "[", "\[Theta]1", "]"}], "2"]}]}]]}]], "Output",
 CellChangeTimes->{3.8612174099322634`*^9},
 CellLabel->
  "Out[637]=",ExpressionUUID->"75a87ba0-6619-4b26-aa48-4744cc841673"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Fix", " ", "Bugs", " ", "here"}], " ", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Ldynamics", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", "*", 
      RowBox[{"x2", "^", "2"}]}], " ", "+", " ", 
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", "*", " ", "A", "*", 
      RowBox[{"l", "^", "2"}], "*", 
      RowBox[{"\[Theta]2", "^", "2"}]}], " ", "+", " ", 
     RowBox[{"A", "*", "l", "*", 
      RowBox[{"Cos", "[", "\[Theta]1", "]"}], "*", "x2", "*", "\[Theta]2"}], 
     " ", "+", " ", 
     RowBox[{"A", "*", "g", "*", "l", "*", 
      RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], " ", "-", " ", 
     RowBox[{"u", "*", "x1"}]}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Note", ":", " ", 
    RowBox[{
    "u", " ", "is", " ", "a", " ", "scaled", " ", "version", " ", "of", " ", 
     "the", " ", "original", " ", "control", " ", "by", " ", "a", " ", 
     "factor", " ", "of", " ", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{"M", "+", "m"}], ")"}]}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fdot", "[", "s_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "x1"}], "]"}], "*", "x2"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "x2"}], "]"}], "*", "x2dot"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "\[Theta]1"}], "]"}], "*", "\[Theta]2"}], " ", "+", 
    " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "\[Theta]2"}], "]"}], "*", "\[Theta]2dot"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqn1", " ", "=", " ", 
   RowBox[{
    RowBox[{"fdot", "[", 
     RowBox[{"D", "[", 
      RowBox[{"Ldynamics", ",", "x2"}], "]"}], "]"}], " ", "-", " ", 
    RowBox[{"D", "[", 
     RowBox[{"Ldynamics", ",", "x1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqn2", " ", "=", " ", 
   RowBox[{
    RowBox[{"fdot", "[", 
     RowBox[{"D", "[", 
      RowBox[{"Ldynamics", ",", "\[Theta]2"}], "]"}], "]"}], " ", "-", " ", 
    RowBox[{"D", "[", 
     RowBox[{"Ldynamics", ",", "\[Theta]1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"eqn1", "==", "0"}], ",", 
        RowBox[{"eqn2", " ", "==", " ", "0"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}], "/.", "sol"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fx", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"x2", ",", "x2dot", ",", "\[Theta]2", ",", "\[Theta]2dot"}], 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ffCartPendulumGeneral", "[", 
   RowBox[{"n_", ",", "\[Tau]_", ",", "\[Tau]1_", ",", "A_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "x1", ",", "x2", ",", "f", ",", "x", ",", "\[Lambda]", ",", "\[Theta]1", 
      ",", "\[Theta]2", ",", "\[Lambda]1", ",", "\[Lambda]2", ",", 
      "\[Lambda]3", ",", "\[Lambda]4", ",", "\[CapitalDelta]t", ",", "bcs", 
      ",", "eqns", ",", "sv", ",", "froot", ",", "x1ff", ",", "x2ff", ",", 
      "x1ff0", ",", "x2ff0", ",", "\[Theta]1ff0", ",", "\[Theta]2ff0", ",", 
      "uff0", ",", "\[Theta]1ff", ",", "\[Theta]2ff", ",", "uff", ",", "l", 
      ",", "g", ",", "Ldynamics", ",", "L"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[CapitalDelta]t", "=", 
      FractionBox["\[Tau]", "n"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"x1", ",", "x2", ",", "\[Theta]1", ",", "\[Theta]2"}], "}"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"\[Lambda]", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
       "\[Lambda]1", ",", "\[Lambda]2", ",", "\[Lambda]3", ",", 
        "\[Lambda]4"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"L", " ", "=", " ", 
      RowBox[{
       RowBox[{"1", "/", "2"}], "*", 
       RowBox[{"u", "^", "2"}]}]}], ";", " ", 
     RowBox[{"(*", 
      RowBox[{"Cost", " ", "function"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"eqn", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{"fx", ",", "u"}], "]"}], ".", "\[Lambda]"}], " ", "+", " ", 
       RowBox[{"D", "[", 
        RowBox[{"L", ",", "u"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sol", " ", "=", " ", 
      RowBox[{
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"eqn", "==", "0"}], "}"}], ",", 
         RowBox[{"{", "u", "}"}]}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "u", "}"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"{", "u", "}"}], "/.", "sol"}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", " ", "=", " ", "0"}], ",", 
       RowBox[{"i", "<", "n"}], ",", 
       RowBox[{"i", "++"}], ",", 
       RowBox[{
        SubscriptBox["u", 
         RowBox[{"i", " "}]], "=", " ", 
        RowBox[{"u", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x1", "->", 
            SubscriptBox["x1", "i"]}], ",", 
           RowBox[{"x2", "->", 
            SubscriptBox["x2", "i"]}], ",", 
           RowBox[{"\[Theta]1", "->", 
            SubscriptBox["\[Theta]1", "i"]}], ",", 
           RowBox[{"\[Theta]2", "->", 
            SubscriptBox["\[Theta]2", "i"]}], ",", 
           RowBox[{"\[Lambda]1", "->", 
            SubscriptBox["\[Lambda]1", "i"]}], ",", 
           RowBox[{"\[Lambda]2", "->", 
            SubscriptBox["\[Lambda]2", "i"]}], ",", 
           RowBox[{"\[Lambda]3", "->", 
            SubscriptBox["\[Lambda]3", "i"]}], ",", 
           RowBox[{"\[Lambda]4", "->", 
            SubscriptBox["\[Lambda]4", "i"]}]}], "}"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"\[Lambda]dot", " ", "=", " ", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{
         RowBox[{"Grad", "[", 
          RowBox[{"fx", ",", "x"}], "]"}], ".", "\[Lambda]"}]}], " ", "-", 
       " ", 
       RowBox[{"Grad", "[", 
        RowBox[{"L", ",", "x"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"{", 
        RowBox[{
        "x1_", ",", "x2_", ",", "\[Theta]1_", ",", "\[Theta]2_", ",", 
         "\[Lambda]1_", ",", "\[Lambda]2_", ",", "\[Lambda]3_", ",", 
         "\[Lambda]4_"}], "}"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{"x2", ",", "x2dot", ",", "\[Theta]2", ",", "\[Theta]2dot", ",", 
        RowBox[{"\[Lambda]dot", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"\[Lambda]dot", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"\[Lambda]dot", "[", 
         RowBox[{"[", "3", "]"}], "]"}], ",", 
        RowBox[{"\[Lambda]dot", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"bcs", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["x1", "0"], "\[Equal]", 
         SubscriptBox["x2", "0"], "\[Equal]", 
         SubscriptBox["x", "n"], "\[Equal]", 
         SubscriptBox["x2", "n"], "\[Equal]", 
         SubscriptBox["\[Theta]1", "0"], "\[Equal]", 
         SubscriptBox["\[Theta]2", "0"], "\[Equal]", 
         SubscriptBox["\[Theta]2", "n"], "\[Equal]", "0"}], ",", 
        RowBox[{
         SubscriptBox["\[Theta]1", "n"], "\[Equal]", "\[Pi]"}]}], "}"}]}], 
     ";", 
     RowBox[{"eqns", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"bcs", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["x1", "i"], ",", 
               SubscriptBox["x2", "i"], ",", 
               SubscriptBox["\[Theta]1", "i"], ",", 
               SubscriptBox["\[Theta]2", "i"], ",", 
               SubscriptBox["\[Lambda]1", "i"], ",", 
               SubscriptBox["\[Lambda]2", "i"], ",", 
               SubscriptBox["\[Lambda]3", "i"], ",", 
               SubscriptBox["\[Lambda]4", "i"]}], "}"}], "\[Equal]", 
             RowBox[{
              RowBox[{
               FractionBox["1", "2"], " ", "\[CapitalDelta]t", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"f", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["x1", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["x2", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Theta]1", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Theta]2", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]1", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]2", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]3", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]4", 
                    RowBox[{"i", "-", "1"}]]}], "}"}], "]"}], "+", 
                 RowBox[{"f", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["x1", "i"], ",", 
                    SubscriptBox["x2", "i"], ",", 
                    SubscriptBox["\[Theta]1", "i"], ",", 
                    SubscriptBox["\[Theta]2", "i"], ",", 
                    SubscriptBox["\[Lambda]1", "i"], ",", 
                    SubscriptBox["\[Lambda]2", "i"], ",", 
                    SubscriptBox["\[Lambda]3", "i"], ",", 
                    SubscriptBox["\[Lambda]4", "i"]}], "}"}], "]"}]}], 
                ")"}]}], "+", 
              RowBox[{"{", 
               RowBox[{
                SubscriptBox["x1", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["x2", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Theta]1", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Theta]2", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]1", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]2", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]3", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]4", 
                 RowBox[{"i", "-", "1"}]]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], "]"}], 
       "]"}]}], ";", 
     RowBox[{"sv", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["x1", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["x2", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Theta]1", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Theta]2", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]1", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]2", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]3", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]4", "i"], ",", "0"}], "}"}]}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], ",", "1"}], 
       "]"}]}], ";", 
     RowBox[{"froot", "=", 
      RowBox[{"FindRoot", "[", 
       RowBox[{"eqns", ",", "sv"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"x1ff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["x1", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"x2ff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["x2", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     RowBox[{"\[Theta]1ff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["\[Theta]1", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     RowBox[{"\[Theta]2ff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["\[Theta]2", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     RowBox[{"uff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           FractionBox[
            RowBox[{
             RowBox[{
              RowBox[{"-", "l"}], " ", "*", 
              SubscriptBox["\[Lambda]2", "i"]}], "+", 
             RowBox[{
              SubscriptBox["\[Lambda]4", "i"], " ", 
              RowBox[{"Cos", "[", 
               SubscriptBox["\[Theta]1", "i"], "]"}]}]}], 
            RowBox[{"l", "*", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "+", 
               RowBox[{"A", " ", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", 
                  SubscriptBox["\[Theta]1", "i"], "]"}], "2"]}]}], ")"}]}]], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"Work", " ", "on", " ", "automation", " ", 
       RowBox[{
        RowBox[{"here", "!!"}], "!"}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1ff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x1ff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x2ff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x2ff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Theta]1ff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Theta]1ff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "\[Pi]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Theta]2ff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Theta]2ff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"uff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"uff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "x1ff", ",", "x2ff", ",", "\[Theta]1ff", ",", "\[Theta]2ff", ",", 
       "uff"}], "}"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TestSwingUpGeneral", "[", 
   RowBox[{"\[Tau]_", ",", "\[Tau]1_", ",", "uff0_", ",", "A_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "eq", ",", "init", ",", "x1", ",", "x2", ",", "\[Theta]1", ",", 
      "\[Theta]2", ",", "x1s", ",", "x2s", ",", "\[Theta]1s", ",", 
      "\[Theta]2s", ",", "t", ",", "replacement"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"replacement", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x1", "->", 
         RowBox[{"x1", "[", "t", "]"}]}], ",", 
        RowBox[{"x2", "->", 
         RowBox[{"x2", "[", "t", "]"}]}], ",", 
        RowBox[{"\[Theta]1", "->", 
         RowBox[{"\[Theta]1", "[", "t", "]"}]}], ",", 
        RowBox[{"\[Theta]2", "->", 
         RowBox[{"\[Theta]2", "[", "t", "]"}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eq", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"x1", "'"}], "[", "t", "]"}], "\[Equal]", 
          RowBox[{"fx", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "/.", "replacement"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"x2", "'"}], "[", "t", "]"}], "\[Equal]", " ", 
          RowBox[{"fx", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "/.", "replacement"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"\[Theta]1", "'"}], "[", "t", "]"}], "\[Equal]", " ", 
          RowBox[{"fx", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "/.", "replacement"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"\[Theta]2", "'"}], "[", "t", "]"}], "\[Equal]", " ", 
          RowBox[{"fx", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "/.", "replacement"}]}], "}"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"init", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"x1", "[", "0", "]"}], "\[Equal]", 
        RowBox[{"x2", "[", "0", "]"}], "\[Equal]", 
        RowBox[{"\[Theta]1", "[", "0", "]"}], "\[Equal]", 
        RowBox[{"\[Theta]2", "[", "0", "]"}], "\[Equal]", "0"}], "}"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x1s", ",", "x2s", ",", "\[Theta]1s", ",", "\[Theta]2s"}], 
       "}"}], "=", 
      RowBox[{"NDSolveValue", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"eq", ",", "init"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"x1", ",", "x2", ",", "\[Theta]1", ",", "\[Theta]2"}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{"t", ",", "0", ",", "\[Tau]1"}], "}"}], ",", 
        RowBox[{"Method", "->", 
         RowBox[{"{", 
          RowBox[{"\"\<DiscontinuityProcessing\>\"", "->", "None"}], 
          "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"x1s", ",", "\[Theta]1s"}], "}"}]}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.861215460097935*^9, 3.861215461363532*^9}, {
  3.8612156017246847`*^9, 3.8612156304924955`*^9}, {3.8612158916640463`*^9, 
  3.861215898636819*^9}, {3.861215939188862*^9, 
  3.8612159580138464`*^9}},ExpressionUUID->"f74f7efe-3ec7-4795-9dd2-\
71449cb219c0"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8612123434557323`*^9, 3.861212464748977*^9}, 
   3.8612125068335314`*^9, {3.8612125785306234`*^9, 3.86121266144913*^9}, {
   3.861212816262667*^9, 3.8612128755747147`*^9}, {3.8612129496750393`*^9, 
   3.8612129512175465`*^9}, {3.8612129968759594`*^9, 
   3.8612130057191353`*^9}, {3.8612131087362185`*^9, 
   3.8612131315979137`*^9}, {3.861213313156903*^9, 3.8612133202886243`*^9}, {
   3.8612133593821335`*^9, 3.8612133596040626`*^9}, {3.8612134864775257`*^9, 
   3.8612137362867107`*^9}, {3.8612145128455915`*^9, 
   3.8612145907037163`*^9}, {3.8612149317847385`*^9, 3.8612150504028387`*^9}, 
   3.8612152995722256`*^9, {3.861215451480689*^9, 3.8612154529402256`*^9}, {
   3.8612158760090485`*^9, 
   3.861215888970907*^9}},ExpressionUUID->"5c9f5518-8773-40d1-9f5d-\
6ccc9ac7fc59"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8612152065859365`*^9, 3.861215255225398*^9}, {
   3.861215321483226*^9, 3.8612153501750565`*^9}, {3.861215415839079*^9, 
   3.8612154261787744`*^9}, {3.861215474700271*^9, 3.861215596402387*^9}, {
   3.8612156441821203`*^9, 3.8612156891627474`*^9}, 
   3.8612158959496775`*^9},ExpressionUUID->"753b940c-4386-4618-9430-\
3cb19cb73947"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "15"}], ";", 
  RowBox[{"\[Tau]", "=", "15"}], ";", 
  RowBox[{"\[Tau]1", "=", " ", 
   RowBox[{"\[Tau]", "*", "1.25"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"A", "=", "0.2"}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "x1a", ",", "x2a", ",", "\[Theta]1a", ",", "\[Theta]2a", ",", "u1a"}], 
     "}"}], "=", 
    RowBox[{"ffCartPendulumGeneral", "[", 
     RowBox[{"n", ",", "\[Tau]", ",", "\[Tau]1", ",", "A"}], "]"}]}], ";"}], 
  "  "}], "\n"}], "Input",
 CellChangeTimes->{{3.861117325438217*^9, 3.861117328912101*^9}, {
   3.861117549789071*^9, 3.861117582074689*^9}, {3.8611176179271593`*^9, 
   3.8611176253517714`*^9}, {3.8611187198568*^9, 3.8611187226858907`*^9}, {
   3.861119603561618*^9, 3.8611196065676517`*^9}, {3.861125833676138*^9, 
   3.861125835239633*^9}, {3.8611262400784445`*^9, 3.861126241635943*^9}, {
   3.861210921914929*^9, 3.8612109271322613`*^9}, 3.861212182366203*^9, {
   3.861215768615363*^9, 3.8612158217543855`*^9}, 3.861215857682905*^9},
 CellLabel->
  "In[446]:=",ExpressionUUID->"c34b2eed-5660-48fe-984b-052e51c617b8"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g", " ", "=", " ", "1"}], ";", 
  RowBox[{"l", " ", "=", " ", "1"}], ";", " ", 
  RowBox[{"A", " ", "=", " ", "0.2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ldynamics", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"1", "/", "2"}], " ", "*", 
     RowBox[{"x2", "^", "2"}]}], " ", "+", " ", 
    RowBox[{
     RowBox[{"1", "/", "2"}], " ", "*", 
     RowBox[{"l", "^", "2"}], "*", 
     RowBox[{"\[Theta]2", "^", "2"}]}], " ", "+", " ", 
    RowBox[{"A", "*", "l", "*", 
     RowBox[{"Cos", "[", "\[Theta]1", "]"}], "*", "x2", "*", "\[Theta]2"}], 
    " ", "+", " ", 
    RowBox[{"A", "*", "g", "*", "l", "*", 
     RowBox[{"Cos", "[", "\[Theta]1", "]"}]}], " ", "-", " ", 
    RowBox[{"u", "*", "x1"}]}]}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Note", ":", " ", 
    RowBox[{
    "u", " ", "is", " ", "a", " ", "scaled", " ", "version", " ", "of", " ", 
     "the", " ", "original", " ", "control", " ", "by", " ", "a", " ", 
     "factor", " ", "of", " ", 
     RowBox[{"1", "/", 
      RowBox[{"(", 
       RowBox[{"M", "+", "m"}], ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"fdot", "[", "s_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "x1"}], "]"}], "*", "x2"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "x2"}], "]"}], "*", "x2dot"}], " ", "+", " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "\[Theta]1"}], "]"}], "*", "\[Theta]2"}], " ", "+", 
    " ", 
    RowBox[{
     RowBox[{"D", "[", 
      RowBox[{"s", ",", "\[Theta]2"}], "]"}], "*", "\[Theta]2dot"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqn1", " ", "=", " ", 
   RowBox[{
    RowBox[{"fdot", "[", 
     RowBox[{"D", "[", 
      RowBox[{"Ldynamics", ",", "x2"}], "]"}], "]"}], " ", "-", " ", 
    RowBox[{"D", "[", 
     RowBox[{"Ldynamics", ",", "x1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqn2", " ", "=", " ", 
   RowBox[{
    RowBox[{"fdot", "[", 
     RowBox[{"D", "[", 
      RowBox[{"Ldynamics", ",", "\[Theta]2"}], "]"}], "]"}], " ", "-", " ", 
    RowBox[{"D", "[", 
     RowBox[{"Ldynamics", ",", "\[Theta]1"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", " ", "=", " ", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"eqn1", "==", "0"}], ",", 
        RowBox[{"eqn2", " ", "==", " ", "0"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"x2dot", ",", "\[Theta]2dot"}], "}"}], "/.", "sol"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fx", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"x2", ",", "x2dot", ",", "\[Theta]2", ",", "\[Theta]2dot"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"x", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"x1", ",", "x2", ",", "\[Theta]1", ",", "\[Theta]2"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Lambda]", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "\[Lambda]1", ",", "\[Lambda]2", ",", "\[Lambda]3", ",", "\[Lambda]4"}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"L", " ", "=", " ", 
   RowBox[{
    RowBox[{"1", "/", "2"}], "*", 
    RowBox[{"u", "^", "2"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Af", " ", "=", " ", 
   RowBox[{"Grad", "[", 
    RowBox[{"fx", ",", "x"}], "]"}]}], ";", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"For", " ", "nD", " ", "stuff", " ", "use", " ", "Grad"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"Bf", " ", "=", " ", 
   RowBox[{"D", "[", 
    RowBox[{"fx", ",", "u"}], "]"}]}], " ", ";", 
  RowBox[{"(*", 
   RowBox[{"For", " ", "1", "D", " ", "stuff", " ", "use", " ", "D"}], "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"Q", " ", "=", " ", 
   RowBox[{"Grad", "[", 
    RowBox[{
     RowBox[{"Grad", "[", 
      RowBox[{"L", ",", "x"}], "]"}], ",", "x"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"M", " ", "=", " ", 
  RowBox[{"Grad", "[", 
   RowBox[{
    RowBox[{"D", "[", 
     RowBox[{"L", ",", "u"}], "]"}], ",", "x"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"R", " ", "=", " ", 
  RowBox[{"D", "[", 
   RowBox[{"L", ",", 
    RowBox[{"{", 
     RowBox[{"u", ",", "2"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{"(", GridBox[{
      {"s11", "s12", "s13", "s14"},
      {"s12", "s22", "s23", "s24"},
      {"s13", "s23", "s33", "s34"},
      {"s14", "s24", "s34", "s44"}
     }], ")"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8611195133726215`*^9, 3.8611195901889176`*^9}, {
   3.861119659423653*^9, 3.861119754390114*^9}, {3.8611202953941393`*^9, 
   3.861120323586073*^9}, {3.8611203536154165`*^9, 3.8611203629884*^9}, {
   3.8611204961145916`*^9, 3.8611205919307795`*^9}, {3.8611207099458275`*^9, 
   3.861120762183028*^9}, {3.8611207998099284`*^9, 3.861120837653758*^9}, {
   3.861120977539774*^9, 3.8611209822532587`*^9}, {3.861121034892331*^9, 
   3.861121161377656*^9}, {3.8611213840850377`*^9, 3.8611213997330046`*^9}, {
   3.861121440676839*^9, 3.861121483918934*^9}, {3.861124485844571*^9, 
   3.8611245940147877`*^9}, {3.861124687080859*^9, 3.8611247995187016`*^9}, {
   3.861124829920924*^9, 3.861124843600525*^9}, {3.861124893653429*^9, 
   3.861124894900028*^9}, 3.8611249473681574`*^9, {3.861125264915039*^9, 
   3.8611252732973433`*^9}, 3.8611255835275784`*^9, 3.8611256136358976`*^9, {
   3.861126177811469*^9, 3.861126180744528*^9}, {3.8611262134600058`*^9, 
   3.8611262187013197`*^9}, {3.8611262580306716`*^9, 3.861126259279271*^9}, {
   3.8611263258828526`*^9, 3.86112632968363*^9}, {3.8611265134295425`*^9, 
   3.861126621482794*^9}, {3.8611267083418617`*^9, 3.861126738905034*^9}, {
   3.86113034777549*^9, 3.861130354070465*^9}, {3.861130431190668*^9, 
   3.8611304456280255`*^9}, 3.861130599894413*^9, {3.8612121451201034`*^9, 
   3.861212152657695*^9}, {3.861213359615059*^9, 3.8612133596200576`*^9}, {
   3.861216226166169*^9, 3.8612162391030393`*^9}, {3.8612162860720296`*^9, 
   3.8612163789663506`*^9}, {3.8612164384103584`*^9, 3.8612164461528845`*^9}, 
   3.8612164807498283`*^9, {3.8612165221376057`*^9, 3.8612165298111563`*^9}, {
   3.861217503343418*^9, 3.861217504294114*^9}, {3.861217944876345*^9, 
   3.86121795497112*^9}, {3.861290469446582*^9, 3.861290494346633*^9}, {
   3.8612905785267596`*^9, 3.861290583450187*^9}, {3.8612906233124638`*^9, 
   3.8612906278120275`*^9}, {3.861290673016597*^9, 3.8612906804752164`*^9}, {
   3.861290873823494*^9, 3.8612909087823343`*^9}, {3.86129109386325*^9, 
   3.861291097758007*^9}, {3.861291242703738*^9, 3.8612912526055765`*^9}, {
   3.8612915327971325`*^9, 3.861291563607297*^9}},
 CellLabel->
  "In[597]:=",ExpressionUUID->"59007b09-abf5-4b67-8b47-f52db40b03a8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8612915653557367`*^9},
 CellLabel->
  "Out[608]=",ExpressionUUID->"ae2f5758-aca3-4e69-b0f7-345a4a88f5d6"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}]], "Output",
 CellChangeTimes->{3.861291565360735*^9},
 CellLabel->
  "Out[609]=",ExpressionUUID->"2bb8f003-8552-4cb8-ad9f-2fe64a06fac6"],

Cell[BoxData["1"], "Output",
 CellChangeTimes->{3.8612915653637342`*^9},
 CellLabel->
  "Out[610]=",ExpressionUUID->"2d0eb83a-1759-47a6-89ba-36af071dc18f"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"x2dot", "/.", 
  RowBox[{"{", 
   RowBox[{"A", "->", "0"}], "}"}]}]], "Input",
 CellChangeTimes->{{3.861291569057557*^9, 3.861291575477507*^9}},
 CellLabel->
  "In[612]:=",ExpressionUUID->"54a1f955-19a7-4d64-a474-d0a36827807b"],

Cell[BoxData[
 RowBox[{"-", 
  FractionBox[
   RowBox[{"1.`", " ", 
    RowBox[{"(", 
     RowBox[{"0.`", "\[VeryThinSpace]", "-", 
      RowBox[{"24.999999999999996`", " ", "u"}], "+", 
      RowBox[{"5.`", " ", 
       SuperscriptBox["\[Theta]2", "2"], " ", 
       RowBox[{"Sin", "[", "\[Theta]1", "]"}]}], "+", 
      RowBox[{"1.`", " ", 
       RowBox[{"Cos", "[", "\[Theta]1", "]"}], " ", 
       RowBox[{"Sin", "[", "\[Theta]1", "]"}]}]}], ")"}]}], 
   RowBox[{
    RowBox[{"-", "24.999999999999996`"}], "+", 
    RowBox[{"1.`", " ", 
     SuperscriptBox[
      RowBox[{"Cos", "[", "\[Theta]1", "]"}], "2"]}]}]]}]], "Output",
 CellChangeTimes->{3.8612915760763144`*^9},
 CellLabel->
  "Out[612]=",ExpressionUUID->"1f271dbd-a5e9-4f91-a33b-e6b8fd6159e7"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["eqn1"], "Input",
 CellChangeTimes->{{3.8612911631531315`*^9, 3.861291164029851*^9}, {
  3.861291209671281*^9, 3.8612912113497467`*^9}},
 CellLabel->
  "In[596]:=",ExpressionUUID->"0ba1aa90-0a92-463e-a87d-3e9dd3ef0dfa"],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.86129116453269*^9, 3.8612912118046*^9},
 CellLabel->
  "Out[596]=",ExpressionUUID->"7d7d01ef-19a9-4b60-9682-8b4d7a4ae84d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ric", " ", "=", " ", 
    RowBox[{"Q", " ", "+", "  ", 
     RowBox[{
      RowBox[{"Af", "\[Transpose]"}], ".", "S"}], " ", "+", 
     RowBox[{"S", ".", "Af"}], " ", "-", " ", 
     RowBox[{
      RowBox[{"S", ".", "Bf", ".", 
       RowBox[{"Bf", "\[Transpose]"}]}], "S"}]}]}], " ", ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"M", " ", "=", " ", "0"}], ",", " ", 
    RowBox[{"R", " ", "=", " ", "1"}]}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"RHS", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{"zero", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "4"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "4"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"solfinal", " ", "=", " ", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{"ric", "==", "RHS"}], ",", 
      RowBox[{"Flatten", "@", "S"}]}], "]"}], " ", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{"S", "/.", "solfinal"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.861125609335279*^9, 3.861125750905754*^9}, {
   3.861126819319172*^9, 3.861126822821048*^9}, {3.861126921796218*^9, 
   3.8611269764006577`*^9}, {3.8611271027930136`*^9, 
   3.8611271032638626`*^9}, {3.861127228426612*^9, 3.8611272944263864`*^9}, {
   3.86112743012675*^9, 3.8611274335866356`*^9}, {3.8611282385107875`*^9, 
   3.8611282416817713`*^9}, {3.8611282805302753`*^9, 3.8611283044085965`*^9}, 
   3.861130508136922*^9, {3.861130542932733*^9, 3.861130565680416*^9}, {
   3.861131467121534*^9, 3.8611314674274316`*^9}, {3.8611317432527337`*^9, 
   3.861131744014488*^9}, {3.861216545193239*^9, 3.8612165481432967`*^9}},
 CellLabel->
  "In[576]:=",ExpressionUUID->"735c901d-554e-4f09-b388-c46f088239f3"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{3.861290275832387*^9, 3.861291144840976*^9},
 CellLabel->
  "Out[578]=",ExpressionUUID->"55986fb8-d461-4ec7-8214-ee01ba8135f8"],

Cell[BoxData[
 TemplateBox[{
  "ReplaceAll", "reps", 
   "\"\\!\\(\\*RowBox[{\\\"{\\\", \\\"solfinal\\\", \\\"}\\\"}]\\) is neither \
a list of replacement rules nor a valid dispatch table, and so cannot be used \
for replacing.\"", 2, 579, 24, 17510583647082069258, "Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.861290275837385*^9, 3.8612911448459754`*^9},
 CellLabel->
  "During evaluation of \
In[576]:=",ExpressionUUID->"844d22fb-d18e-4e84-9fc0-b323010e95aa"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.861125895065395*^9, 3.861125903575659*^9}, {
  3.861126755663644*^9, 
  3.8611267789481564`*^9}},ExpressionUUID->"81cdf9f7-01ba-45aa-92d7-\
6a97be7d1a9d"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.86112594610798*^9, 3.8611259488381042`*^9}, {
  3.861126028812385*^9, 
  3.861126031570496*^9}},ExpressionUUID->"2f7d4b18-5ada-4496-aa5c-\
a47b9af34830"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tempfile", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"$TemporaryDirectory", ",", "\"\<saved.wl\>\""}], "}"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Save", "[", 
   RowBox[{"tempfile", ",", "S"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8611313046437807`*^9, 3.8611313046437807`*^9}, {
  3.861131339163679*^9, 3.861131347906868*^9}},
 CellLabel->
  "In[215]:=",ExpressionUUID->"4c3be56d-ebad-4bdb-af1a-3c49bcb38743"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.861131333197599*^9, 3.86113133807603*^9}, {
  3.8611313705335937`*^9, 
  3.861131406473035*^9}},ExpressionUUID->"472d2e9f-b0a9-4cf8-9488-\
946019ccb43e"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"tempfile", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{"$TemporaryDirectory", ",", "\"\<saved.wl\>\""}], "}"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Get", "[", "tempfile", "]"}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"S", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1"}], "]"}], "]"}], "/.", 
  RowBox[{"{", 
   RowBox[{"zero", " ", "->", " ", "0.00001"}], "}"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "original", " ", "expression", " ", "had", " ", "no", " ", 
    "solution"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.8611314090422087`*^9, 3.8611314267865024`*^9}, {
  3.86113186992*^9, 3.86113187057379*^9}, {3.861216156060569*^9, 
  3.861216156299495*^9}},
 CellLabel->
  "In[474]:=",ExpressionUUID->"36012760-7a39-48b4-a982-9455c37cc948"],

Cell[BoxData[
 RowBox[{"2.5`*^-6", "-", 
  RowBox[{"5.000000000000001`*^-7", " ", 
   RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
  RowBox[{
   FractionBox["1", "2"], " ", 
   RowBox[{"\[Sqrt]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox["1", "100"], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "0.00005`"}], "+", 
          RowBox[{"0.00001`", " ", 
           RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"]}], "+", 
      RowBox[{
       FractionBox["1", "50"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "2.5000000000000005`*^-9"}], "+", 
         RowBox[{"1.0000000000000003`*^-9", " ", 
          RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
         RowBox[{"1.0000000000000002`*^-10", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "150"], " ", 
       RowBox[{"(", 
        RowBox[{"2.5000000000000005`*^-9", "-", 
         RowBox[{"1.0000000000000003`*^-9", " ", 
          RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
         RowBox[{"1.0000000000000002`*^-10", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"8.399473665965824`*^-18", " ", 
         RowBox[{"(", 
          RowBox[{"1.81500000625`*^6", "-", 
           RowBox[{"0.005`", " ", 
            RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
           RowBox[{"329999.9985`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "-", 
           RowBox[{"0.0002`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "theta1", "]"}], "3"]}], "+", 
           RowBox[{"15000.00001`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], ")"}], 
       "/", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"2.5000000000000005`*^-9", "-", 
              RowBox[{"1.0000000000000003`*^-9", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
              RowBox[{"1.0000000000000002`*^-10", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], "3"]}], 
          "+", 
          RowBox[{"67500", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.00005`"}], "+", 
              RowBox[{"0.00001`", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "-", 
          RowBox[{"90000", " ", 
           RowBox[{"(", 
            RowBox[{"2.5000000000000005`*^-9", "-", 
             RowBox[{"1.0000000000000003`*^-9", " ", 
              RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
             RowBox[{"1.0000000000000002`*^-10", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "+", 
          RowBox[{"\[Sqrt]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], " ", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "2"], "+", 
                 RowBox[{"15000", " ", 
                  RowBox[{"(", 
                   RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                ")"}], "3"]}], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "3"]}], "+", 
                RowBox[{"67500", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "-", 
                RowBox[{"90000", " ", 
                 RowBox[{"(", 
                  RowBox[{"2.5000000000000005`*^-9", "-", 
                   RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                   RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
               ")"}], "2"]}], ")"}]}]}], ")"}], 
        RowBox[{"1", "/", "3"}]]}], "+", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"150", " ", 
         SuperscriptBox["2", 
          RowBox[{"1", "/", "3"}]]}]], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"2.5000000000000005`*^-9", "-", 
              RowBox[{"1.0000000000000003`*^-9", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
              RowBox[{"1.0000000000000002`*^-10", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], "3"]}], 
          "+", 
          RowBox[{"67500", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.00005`"}], "+", 
              RowBox[{"0.00001`", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "-", 
          RowBox[{"90000", " ", 
           RowBox[{"(", 
            RowBox[{"2.5000000000000005`*^-9", "-", 
             RowBox[{"1.0000000000000003`*^-9", " ", 
              RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
             RowBox[{"1.0000000000000002`*^-10", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "+", 
          RowBox[{"\[Sqrt]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], " ", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "2"], "+", 
                 RowBox[{"15000", " ", 
                  RowBox[{"(", 
                   RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                ")"}], "3"]}], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "3"]}], "+", 
                RowBox[{"67500", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "-", 
                RowBox[{"90000", " ", 
                 RowBox[{"(", 
                  RowBox[{"2.5000000000000005`*^-9", "-", 
                   RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                   RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
               ")"}], "2"]}], ")"}]}]}], ")"}], 
        RowBox[{"1", "/", "3"}]]}]}], ")"}]}]}], "-", 
  RowBox[{
   FractionBox["1", "2"], " ", 
   RowBox[{"\[Sqrt]", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox["1", "50"], " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "0.00005`"}], "+", 
          RowBox[{"0.00001`", " ", 
           RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"]}], "+", 
      RowBox[{
       FractionBox["2", "75"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "2.5000000000000005`*^-9"}], "+", 
         RowBox[{"1.0000000000000003`*^-9", " ", 
          RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
         RowBox[{"1.0000000000000002`*^-10", " ", 
          SuperscriptBox[
           RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}]}], "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"8.399473665965824`*^-18", " ", 
         RowBox[{"(", 
          RowBox[{"1.81500000625`*^6", "-", 
           RowBox[{"0.005`", " ", 
            RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
           RowBox[{"329999.9985`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "-", 
           RowBox[{"0.0002`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "theta1", "]"}], "3"]}], "+", 
           RowBox[{"15000.00001`", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], ")"}], 
       "/", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"2.5000000000000005`*^-9", "-", 
              RowBox[{"1.0000000000000003`*^-9", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
              RowBox[{"1.0000000000000002`*^-10", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], "3"]}], 
          "+", 
          RowBox[{"67500", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.00005`"}], "+", 
              RowBox[{"0.00001`", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "-", 
          RowBox[{"90000", " ", 
           RowBox[{"(", 
            RowBox[{"2.5000000000000005`*^-9", "-", 
             RowBox[{"1.0000000000000003`*^-9", " ", 
              RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
             RowBox[{"1.0000000000000002`*^-10", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "+", 
          RowBox[{"\[Sqrt]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], " ", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "2"], "+", 
                 RowBox[{"15000", " ", 
                  RowBox[{"(", 
                   RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                ")"}], "3"]}], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "3"]}], "+", 
                RowBox[{"67500", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "-", 
                RowBox[{"90000", " ", 
                 RowBox[{"(", 
                  RowBox[{"2.5000000000000005`*^-9", "-", 
                   RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                   RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
               ")"}], "2"]}], ")"}]}]}], ")"}], 
        RowBox[{"1", "/", "3"}]]}], "-", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"150", " ", 
         SuperscriptBox["2", 
          RowBox[{"1", "/", "3"}]]}]], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{"2", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"2.5000000000000005`*^-9", "-", 
              RowBox[{"1.0000000000000003`*^-9", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
              RowBox[{"1.0000000000000002`*^-10", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], "3"]}], 
          "+", 
          RowBox[{"67500", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.00005`"}], "+", 
              RowBox[{"0.00001`", " ", 
               RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "-", 
          RowBox[{"90000", " ", 
           RowBox[{"(", 
            RowBox[{"2.5000000000000005`*^-9", "-", 
             RowBox[{"1.0000000000000003`*^-9", " ", 
              RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
             RowBox[{"1.0000000000000002`*^-10", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
           RowBox[{"(", 
            RowBox[{"1.2100000000000004`*^-13", "-", 
             RowBox[{"2.2000000000000007`*^-14", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
             RowBox[{"1.0000000000000003`*^-15", " ", 
              SuperscriptBox[
               RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], "+", 
          RowBox[{"\[Sqrt]", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "4"}], " ", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "2"], "+", 
                 RowBox[{"15000", " ", 
                  RowBox[{"(", 
                   RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                ")"}], "3"]}], "+", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "3"]}], "+", 
                RowBox[{"67500", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "-", 
                RowBox[{"90000", " ", 
                 RowBox[{"(", 
                  RowBox[{"2.5000000000000005`*^-9", "-", 
                   RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                   RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
               ")"}], "2"]}], ")"}]}]}], ")"}], 
        RowBox[{"1", "/", "3"}]]}], "-", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           FractionBox["1", "125"]}], " ", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "0.00005`"}], "+", 
             RowBox[{"0.00001`", " ", 
              RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "3"]}], "+", 
         RowBox[{
          FractionBox["2", "125"], " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "0.00005`"}], "+", 
            RowBox[{"0.00001`", " ", 
             RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], " ", 
          RowBox[{"(", 
           RowBox[{"2.5000000000000005`*^-9", "-", 
            RowBox[{"1.0000000000000003`*^-9", " ", 
             RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
            RowBox[{"1.0000000000000002`*^-10", " ", 
             SuperscriptBox[
              RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}]}]}], ")"}],
        "/", 
       RowBox[{"(", 
        RowBox[{"4", " ", 
         RowBox[{"\[Sqrt]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox["1", "100"], " ", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "0.00005`"}], "+", 
                RowBox[{"0.00001`", " ", 
                 RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"]}], "+", 
            RowBox[{
             FractionBox["1", "50"], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "2.5000000000000005`*^-9"}], "+", 
               RowBox[{"1.0000000000000003`*^-9", " ", 
                RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
               RowBox[{"1.0000000000000002`*^-10", " ", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}]}], "+", 
            RowBox[{
             FractionBox["1", "150"], " ", 
             RowBox[{"(", 
              RowBox[{"2.5000000000000005`*^-9", "-", 
               RowBox[{"1.0000000000000003`*^-9", " ", 
                RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
               RowBox[{"1.0000000000000002`*^-10", " ", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"8.399473665965824`*^-18", " ", 
               RowBox[{"(", 
                RowBox[{"1.81500000625`*^6", "-", 
                 RowBox[{"0.005`", " ", 
                  RowBox[{"Cos", "[", "theta1", "]"}]}], "-", 
                 RowBox[{"329999.9985`", " ", 
                  SuperscriptBox[
                   RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "-", 
                 RowBox[{"0.0002`", " ", 
                  SuperscriptBox[
                   RowBox[{"Cos", "[", "theta1", "]"}], "3"]}], "+", 
                 RowBox[{"15000.00001`", " ", 
                  SuperscriptBox[
                   RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
              ")"}], "/", 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "3"]}], "+", 
                RowBox[{"67500", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "-", 
                RowBox[{"90000", " ", 
                 RowBox[{"(", 
                  RowBox[{"2.5000000000000005`*^-9", "-", 
                   RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                   RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "+", 
                RowBox[{"\[Sqrt]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "4"}], " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                    "2"], "+", 
                    RowBox[{"15000", " ", 
                    RowBox[{"(", 
                    RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                    ")"}], "3"]}], "+", 
                   SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                    "3"]}], "+", 
                    RowBox[{"67500", " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                    RowBox[{"(", 
                    RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                    "-", 
                    RowBox[{"90000", " ", 
                    RowBox[{"(", 
                    RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                    ")"}], "2"]}], ")"}]}]}], ")"}], 
              RowBox[{"1", "/", "3"}]]}], "+", 
            RowBox[{
             FractionBox["1", 
              RowBox[{"150", " ", 
               SuperscriptBox["2", 
                RowBox[{"1", "/", "3"}]]}]], 
             SuperscriptBox[
              RowBox[{"(", 
               RowBox[{
                RowBox[{"2", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                  "3"]}], "+", 
                RowBox[{"67500", " ", 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "-", 
                RowBox[{"90000", " ", 
                 RowBox[{"(", 
                  RowBox[{"2.5000000000000005`*^-9", "-", 
                   RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                   RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{"1.2100000000000004`*^-13", "-", 
                   RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                   RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                "+", 
                RowBox[{"\[Sqrt]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "4"}], " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                    "2"], "+", 
                    RowBox[{"15000", " ", 
                    RowBox[{"(", 
                    RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                    ")"}], "3"]}], "+", 
                   SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"2", " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], 
                    "3"]}], "+", 
                    RowBox[{"67500", " ", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "0.00005`"}], "+", 
                    RowBox[{"0.00001`", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}]}], ")"}], "2"], " ", 
                    RowBox[{"(", 
                    RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}], 
                    "-", 
                    RowBox[{"90000", " ", 
                    RowBox[{"(", 
                    RowBox[{"2.5000000000000005`*^-9", "-", 
                    RowBox[{"1.0000000000000003`*^-9", " ", 
                    RowBox[{"Cos", "[", "theta1", "]"}]}], "+", 
                    RowBox[{"1.0000000000000002`*^-10", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}]}], ")"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"1.2100000000000004`*^-13", "-", 
                    RowBox[{"2.2000000000000007`*^-14", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "2"]}], "+", 
                    RowBox[{"1.0000000000000003`*^-15", " ", 
                    SuperscriptBox[
                    RowBox[{"Cos", "[", "theta1", "]"}], "4"]}]}], ")"}]}]}], 
                    ")"}], "2"]}], ")"}]}]}], ")"}], 
              RowBox[{"1", "/", "3"}]]}]}], ")"}]}]}], ")"}]}]}], 
     ")"}]}]}]}]], "Output",
 CellChangeTimes->{3.8612902806858377`*^9},
 CellLabel->
  "Out[476]=",ExpressionUUID->"0d4cd45a-1c99-4037-8924-c311c9aa3d30"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.86113144840655*^9, 3.8611314520653725`*^9}, {
   3.861131538409607*^9, 3.861131545769241*^9}, {3.8611316959319506`*^9, 
   3.861131716215427*^9}, {3.861131752588732*^9, 3.861131765728504*^9}, 
   3.8612161545150642`*^9},ExpressionUUID->"f7bf82e6-0c99-49fa-98ee-\
38ecbaa32843"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.861131702664786*^9, 3.861131710946121*^9}, {
  3.8611319528213396`*^9, 
  3.8611319540719395`*^9}},ExpressionUUID->"9055d6ce-c8fa-410b-9ad4-\
74275232b17f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ffCartPendulumGeneral", "[", 
   RowBox[{"n_", ",", "\[Tau]_", ",", "\[Tau]1_", ",", "A_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "x", ",", "xdot", ",", "f", ",", "\[Theta]", ",", "\[Theta]dot", ",", 
      "\[Lambda]1", ",", "\[Lambda]2", ",", "\[Lambda]3", ",", "\[Lambda]4", 
      ",", "\[CapitalDelta]t", ",", "bcs", ",", "eqns", ",", "sv", ",", 
      "froot", ",", "xff", ",", "xdotff", ",", "xff0", ",", "xdotff0", ",", 
      "\[Theta]ff0", ",", "\[Theta]dotff0", ",", "uff0", ",", "\[Theta]ff", 
      ",", "\[Theta]dotff", ",", "uff"}], "}"}], ",", 
    RowBox[{
     RowBox[{"\[CapitalDelta]t", "=", 
      FractionBox["\[Tau]", "n"]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"{", 
        RowBox[{
        "x_", ",", "xdot_", ",", "\[Theta]_", ",", "\[Theta]dot_", ",", 
         "\[Lambda]1_", ",", "\[Lambda]2_", ",", "\[Lambda]3_", ",", 
         "\[Lambda]4_"}], "}"}], "]"}], ":=", 
      RowBox[{"{", 
       RowBox[{"xdot", ",", 
        RowBox[{
         FractionBox["1", 
          RowBox[{"1", "-", 
           RowBox[{"A", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"A", " ", 
            SuperscriptBox["\[Theta]dot", "2"], 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "+", 
           RowBox[{
            FractionBox["1", 
             RowBox[{"1", "-", 
              RowBox[{"A", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"\[Lambda]4", " ", 
               RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "-", "\[Lambda]2"}], 
             ")"}]}], "+", 
           RowBox[{"A", " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ")"}]}], ",", 
        "\[Theta]dot", ",", 
        RowBox[{
         FractionBox["1", 
          RowBox[{"1", "-", 
           RowBox[{"A", " ", 
            SuperscriptBox[
             RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]], 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             FractionBox["1", 
              RowBox[{"1", "-", 
               RowBox[{"A", " ", 
                SuperscriptBox[
                 RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}]]}], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "\[Lambda]2"}], " ", 
               RowBox[{"Cos", "[", "\[Theta]", "]"}]}], "+", 
              RowBox[{"\[Lambda]4", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", "\[Theta]", "]"}], "2"]}]}], ")"}]}], "-", 
           RowBox[{"Sin", "[", "\[Theta]", "]"}], "-", 
           RowBox[{"A", " ", 
            SuperscriptBox["\[Theta]dot", "2"], " ", 
            RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}]}]}], ")"}]}], ",", "0", ",", 
        RowBox[{"-", "\[Lambda]1"}], ",", 
        RowBox[{
         FractionBox["2", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"A", " ", 
              RowBox[{"Cos", "[", 
               RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", "A", "-", "2"}], 
            ")"}], "3"]], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Cos", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"4", " ", 
               RowBox[{"Sin", "[", "\[Theta]", "]"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"A", " ", 
                  SuperscriptBox["\[Lambda]4", "2"], " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", 
                 RowBox[{"4", " ", "A", " ", 
                  SuperscriptBox["\[Lambda]2", "2"]}], "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"A", "+", "2"}], ")"}], " ", 
                  SuperscriptBox["\[Lambda]4", "2"]}]}], ")"}]}], "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"A", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "-", 
                 RowBox[{"3", " ", "A"}], "+", "2"}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"A", " ", 
                  RowBox[{"Cos", "[", 
                   RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", "A", "-", 
                 "2"}], ")"}], " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"A", " ", 
                  SuperscriptBox["\[Theta]dot", "2"], " ", "\[Lambda]2"}], 
                 "-", "\[Lambda]4"}], ")"}]}]}], ")"}]}], "+", 
           RowBox[{"A", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"A", "-", "2"}], ")"}], " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", "A"}], ")"}], 
            " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"A", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", "A", "-", "2"}],
              ")"}], " ", 
            RowBox[{"(", 
             RowBox[{"\[Lambda]2", "-", 
              RowBox[{
               SuperscriptBox["\[Theta]dot", "2"], " ", "\[Lambda]4"}]}], 
             ")"}]}], "-", 
           RowBox[{"4", " ", "\[Lambda]2", " ", "\[Lambda]4", " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"3", " ", "A", " ", 
               RowBox[{"Cos", "[", 
                RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", 
              RowBox[{"3", " ", "A"}], "+", "2"}], ")"}]}]}], ")"}]}], ",", 
        RowBox[{
         RowBox[{
          FractionBox[
           RowBox[{"4", " "}], 
           RowBox[{
            RowBox[{"A", " ", 
             RowBox[{"Cos", "[", 
              RowBox[{"2", " ", "\[Theta]"}], "]"}]}], "+", "A", "-", "2"}]], 
          RowBox[{"(", 
           RowBox[{"A", " ", "\[Theta]dot", " ", 
            RowBox[{"Sin", "[", "\[Theta]", "]"}], " ", 
            RowBox[{"(", 
             RowBox[{"\[Lambda]2", "-", 
              RowBox[{"\[Lambda]4", " ", 
               RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], ")"}]}], ")"}]}], 
         "-", "\[Lambda]3"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"bcs", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         SubscriptBox["x", "0"], "\[Equal]", 
         SubscriptBox["xdot", "0"], "\[Equal]", 
         SubscriptBox["x", "n"], "\[Equal]", 
         SubscriptBox["xdot", "n"], "\[Equal]", 
         SubscriptBox["\[Theta]", "0"], "\[Equal]", 
         SubscriptBox["\[Theta]dot", "0"], "\[Equal]", 
         SubscriptBox["\[Theta]dot", "n"], "\[Equal]", "0"}], ",", 
        RowBox[{
         SubscriptBox["\[Theta]", "n"], "\[Equal]", "\[Pi]"}]}], "}"}]}], ";", 
     RowBox[{"eqns", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Join", "[", 
        RowBox[{"bcs", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Thread", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["x", "i"], ",", 
               SubscriptBox["xdot", "i"], ",", 
               SubscriptBox["\[Theta]", "i"], ",", 
               SubscriptBox["\[Theta]dot", "i"], ",", 
               SubscriptBox["\[Lambda]1", "i"], ",", 
               SubscriptBox["\[Lambda]2", "i"], ",", 
               SubscriptBox["\[Lambda]3", "i"], ",", 
               SubscriptBox["\[Lambda]4", "i"]}], "}"}], "\[Equal]", 
             RowBox[{
              RowBox[{
               FractionBox["1", "2"], " ", "\[CapitalDelta]t", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"f", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["x", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["xdot", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Theta]", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Theta]dot", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]1", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]2", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]3", 
                    RowBox[{"i", "-", "1"}]], ",", 
                    SubscriptBox["\[Lambda]4", 
                    RowBox[{"i", "-", "1"}]]}], "}"}], "]"}], "+", 
                 RowBox[{"f", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    SubscriptBox["x", "i"], ",", 
                    SubscriptBox["xdot", "i"], ",", 
                    SubscriptBox["\[Theta]", "i"], ",", 
                    SubscriptBox["\[Theta]dot", "i"], ",", 
                    SubscriptBox["\[Lambda]1", "i"], ",", 
                    SubscriptBox["\[Lambda]2", "i"], ",", 
                    SubscriptBox["\[Lambda]3", "i"], ",", 
                    SubscriptBox["\[Lambda]4", "i"]}], "}"}], "]"}]}], 
                ")"}]}], "+", 
              RowBox[{"{", 
               RowBox[{
                SubscriptBox["x", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["xdot", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Theta]", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Theta]dot", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]1", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]2", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]3", 
                 RowBox[{"i", "-", "1"}]], ",", 
                SubscriptBox["\[Lambda]4", 
                 RowBox[{"i", "-", "1"}]]}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], "]"}], 
       "]"}]}], ";", 
     RowBox[{"sv", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["x", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["xdot", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Theta]", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Theta]dot", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]1", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]2", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]3", "i"], ",", "0"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["\[Lambda]4", "i"], ",", "0"}], "}"}]}], "}"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], ",", "1"}], 
       "]"}]}], ";", 
     RowBox[{"froot", "=", 
      RowBox[{"FindRoot", "[", 
       RowBox[{"eqns", ",", "sv"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"xff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["x", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xdotff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["xdot", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     RowBox[{"\[Theta]ff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["\[Theta]", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     RowBox[{"\[Theta]dotff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           SubscriptBox["\[Theta]dot", "i"], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     RowBox[{"uff0", "=", 
      RowBox[{"ListInterpolation", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            FractionBox["1", 
             RowBox[{"1", "-", 
              RowBox[{"A", " ", 
               SuperscriptBox[
                RowBox[{"Cos", "[", 
                 SubscriptBox["\[Theta]", "i"], "]"}], "2"]}]}]], 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               SubscriptBox["\[Lambda]4", "i"], 
               RowBox[{"Cos", "[", 
                SubscriptBox["\[Theta]", "i"], "]"}]}], "-", 
              SubscriptBox["\[Lambda]2", "i"]}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "n"}], "}"}]}], "]"}], "/.", 
         "\[VeryThinSpace]", "froot"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "\[Tau]"}], "}"}], ",", 
        RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"xff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xdotff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"xdotff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Theta]ff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Theta]ff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "\[Pi]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Theta]dotff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\[Theta]dotff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"uff", "[", "t_", "]"}], ":=", 
      RowBox[{"Piecewise", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"uff0", "[", "t", "]"}], ",", 
           RowBox[{"0", "\[LessEqual]", "t", "\[LessEqual]", "\[Tau]"}]}], 
          "}"}], "}"}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "xff", ",", "xdotff", ",", "\[Theta]ff", ",", "\[Theta]dotff", ",", 
       "uff"}], "}"}]}]}], "]"}]}]}], "Input",
 CellLabel->
  "In[452]:=",ExpressionUUID->"a7f9761f-765e-4a7e-8c08-2c99a96f8ef5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"n", "=", "15"}], ";", 
  RowBox[{"\[Tau]", "=", "15"}], ";", 
  RowBox[{"\[Tau]1", "=", " ", 
   RowBox[{"\[Tau]", "*", "1.25"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"A", "=", "0.2"}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "x1a", ",", "x2a", ",", "\[Theta]1a", ",", "\[Theta]2a", ",", "u1a"}], 
     "}"}], "=", 
    RowBox[{"ffCartPendulumGeneral", "[", 
     RowBox[{"n", ",", "\[Tau]", ",", "\[Tau]1", ",", "A"}], "]"}]}], ";"}], 
  "  "}]}], "Input",
 CellLabel->
  "In[454]:=",ExpressionUUID->"3b5e25a3-6d28-4329-bc03-781740ad2ad0"],

Cell[BoxData[
 RowBox[{"m", " ", "=", " "}]], "Input",
 CellChangeTimes->{{3.86121614370652*^9, 
  3.861216147745227*^9}},ExpressionUUID->"eb7f75d4-3cd8-4917-9a91-\
4c521ea2ff0d"]
},
WindowSize->{1440., 747.75},
WindowMargins->{{-6, Automatic}, {Automatic, -6}},
FrontEndVersion->"13.0 for Microsoft Windows (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ca598963-128c-4a20-99e2-48c17eda7fe1"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 241, 6, 35, "Text",ExpressionUUID->"f7026908-7082-487f-b65f-902389ac6090"],
Cell[802, 28, 5592, 133, 295, "Input",ExpressionUUID->"855cd7fd-98fc-48d5-9e59-76633f5ca378"],
Cell[CellGroupData[{
Cell[6419, 165, 182, 3, 28, "Input",ExpressionUUID->"6fb4e5f0-4b6e-4655-a3ea-431f38791ce4"],
Cell[6604, 170, 633, 18, 54, "Output",ExpressionUUID->"75a87ba0-6619-4b26-aa48-4744cc841673"]
}, Open  ]],
Cell[7252, 191, 21372, 555, 1019, "Input",ExpressionUUID->"f74f7efe-3ec7-4795-9dd2-71449cb219c0"],
Cell[28627, 748, 832, 13, 28, "Input",ExpressionUUID->"5c9f5518-8773-40d1-9f5d-6ccc9ac7fc59"],
Cell[29462, 763, 383, 6, 28, "Input",ExpressionUUID->"753b940c-4386-4618-9430-3cb19cb73947"],
Cell[29848, 771, 1197, 27, 86, "Input",ExpressionUUID->"c34b2eed-5660-48fe-984b-052e51c617b8"],
Cell[CellGroupData[{
Cell[31070, 802, 7218, 177, 432, "Input",ExpressionUUID->"59007b09-abf5-4b67-8b47-f52db40b03a8"],
Cell[38291, 981, 496, 13, 32, "Output",ExpressionUUID->"ae2f5758-aca3-4e69-b0f7-345a4a88f5d6"],
Cell[38790, 996, 218, 5, 32, "Output",ExpressionUUID->"2bb8f003-8552-4cb8-ad9f-2fe64a06fac6"],
Cell[39011, 1003, 155, 3, 32, "Output",ExpressionUUID->"2d0eb83a-1759-47a6-89ba-36af071dc18f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[39203, 1011, 251, 6, 28, "Input",ExpressionUUID->"54a1f955-19a7-4d64-a474-d0a36827807b"],
Cell[39457, 1019, 759, 20, 55, "Output",ExpressionUUID->"1f271dbd-a5e9-4f91-a33b-e6b8fd6159e7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40253, 1044, 232, 4, 28, "Input",ExpressionUUID->"0ba1aa90-0a92-463e-a87d-3e9dd3ef0dfa"],
Cell[40488, 1050, 172, 3, 32, "Output",ExpressionUUID->"7d7d01ef-19a9-4b60-9682-8b4d7a4ae84d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40697, 1058, 1837, 44, 86, "Input",ExpressionUUID->"735c901d-554e-4f09-b388-c46f088239f3"],
Cell[42537, 1104, 182, 3, 32, "Output",ExpressionUUID->"55986fb8-d461-4ec7-8214-ee01ba8135f8"],
Cell[42722, 1109, 489, 10, 28, "Message",ExpressionUUID->"844d22fb-d18e-4e84-9fc0-b323010e95aa"]
}, Open  ]],
Cell[43226, 1122, 203, 4, 28, "Input",ExpressionUUID->"81cdf9f7-01ba-45aa-92d7-6a97be7d1a9d"],
Cell[43432, 1128, 202, 4, 28, "Input",ExpressionUUID->"2f7d4b18-5ada-4496-aa5c-a47b9af34830"],
Cell[43637, 1134, 512, 13, 48, "Input",ExpressionUUID->"4c3be56d-ebad-4bdb-af1a-3c49bcb38743"],
Cell[44152, 1149, 202, 4, 28, "Input",ExpressionUUID->"472d2e9f-b0a9-4cf8-9488-946019ccb43e"],
Cell[CellGroupData[{
Cell[44379, 1157, 886, 24, 67, "Input",ExpressionUUID->"36012760-7a39-48b4-a982-9455c37cc948"],
Cell[45268, 1183, 40485, 899, 1008, "Output",ExpressionUUID->"0d4cd45a-1c99-4037-8924-c311c9aa3d30"]
}, Open  ]],
Cell[85768, 2085, 326, 5, 28, "Input",ExpressionUUID->"f7bf82e6-0c99-49fa-98ee-38ecbaa32843"],
Cell[86097, 2092, 205, 4, 28, "Input",ExpressionUUID->"9055d6ce-c8fa-410b-9ad4-74275232b17f"],
Cell[86305, 2098, 17294, 436, 708, "Input",ExpressionUUID->"a7f9761f-765e-4a7e-8c08-2c99a96f8ef5"],
Cell[103602, 2536, 677, 20, 67, "Input",ExpressionUUID->"3b5e25a3-6d28-4329-bc03-781740ad2ad0"],
Cell[104282, 2558, 179, 4, 28, "Input",ExpressionUUID->"eb7f75d4-3cd8-4917-9a91-4c521ea2ff0d"]
}
]
*)

